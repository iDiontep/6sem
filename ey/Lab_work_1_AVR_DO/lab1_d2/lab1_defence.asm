;*************************************
;* Designer        Ionin D.A..
;* Version:        2.0
;* Date            23.03.2024
;* Title:          Countert.asm
;* Device          ATmega16
;* Clock frequency: 8 MHz Crystal Resonator
;*************************************

.include "m16def.inc"


.def tempL	  = R16				; ??????? ??????????? ???????
.def tempH    = R17             ; ??????? ??????????? ???????
.def temp  = R18				; ??????? ????????
.def Counter   = R19
.cseg
.org $0000
rjmp InitStack

;==================================================================================================
; ??????????
;==================================================================================================
.org  INT0addr					; $0002	??????? ?????????? ???????? 0
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  INT1addr					; $0004	??????? ?????????? ???????? 1
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OC2addr					; $0006	?????????? ?? ?????? ???????-???????? 2
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OVF2addr					; $0008	??????-??????? 2 ??????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  ICP1addr					; $000A	?????? ??????? ????????-????????? 1
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OC1Aaddr					; $000C	?????????? ?? ?????? A ???????-???????? 1
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OC1Baddr					; $000E	?????????? ?? ?????? B ???????-???????? 1
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OVF1addr					; $0010	??????-??????? 1 ??????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  OVF0addr					; $0012	??????-??????? 0 ??????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  SPIaddr					; $0014	???????? ?? ????????????????? ?????????? ?????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  URXCaddr					; $0016	????? ?? ??????-??????????? ????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org  UDREaddr					; $0018	??????? ?????? ??????-??????????? ????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org UTXCaddr					; $001A	???????? ?? ??????-??????????? ?????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org ADCCaddr					; $001C ?????????-???????? ?????????????? ?????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org ERDYaddr					; $001E	?????????? ????????????????? ??????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org ACIaddr					; $0020	?????????? ??????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org TWIaddr					; $0022 ????????????? ???????????????? ?????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org INT2addr					; $0024 ??????? ?????????? ???????? 2
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org OC0addr					; $0026 ?????????? ?? ?????? ???????-???????? 0
reti							; ? ??????? ?????????? ??? ???????????? ?????????

.org SPMRaddr					; $0028 ?????????? ?????? ? ?????? ????????
reti							; ? ??????? ?????????? ??? ???????????? ?????????
;==================================================================================================
InitStack:  	  
	ldi	   tempL, Low(RAMEND)	; ???????? ???????? ????? ?????? ??????? ????? 
	ldi    tempH, High(RAMEND)  ; ???????? ???????? ????? ?????? ??????? ?????
	out	   SPL, tempL           ; ????????????? ???????? ????? ?????? ??????? ?????
	out    SPH, tempH           ; ????????????? ???????? ????? ?????? ??????? ????? 
; Initialize Ports
Init:
    ldi temp, 0b11111111    ; Set PortA as outputs
    out DDRA, temp
    ldi temp, 0b00000011    ; Set PB4 as input
    out PORTA, temp
    
	ldi temp, 0b00000000    ; Set PortA as outputs
    out DDRB, temp
    ldi temp, 0x10    ; Enable pull-up for PB4
    out PORTB, temp
    
    ldi Counter, 0x00 ; Initialize counter

MainLoop:
    sbic PINB, 4       ; Check if button on PB4 is pressed
    rjmp MainLoop      ; Button not pressed, continue loop

    inc Counter        ; Increment counter

    cpi Counter, 0x03  ; Check if counter equals 3
    brne CheckCounter  ; If not 3, continue

    ldi Counter, 0x00  ; Reset counter after reaching 3

CheckCounter:
    mov temp, Counter  ; Load counter value to temp

    ; Shift the LED pattern to the left based on the counter value
    lsl temp
    out PORTA, temp    ; Output to LEDs

    rcall Delay        ; Delay for debounce

    rjmp MainLoop      ; Continue looping

Delay:
    ldi temp, 0xFF     ; Load delay value
    delay_loop:
        dec temp
        brne delay_loop
    ret
	

;.end
